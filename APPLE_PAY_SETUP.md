# Apple Pay Sandbox Setup Guide

## Overview
This guide will help you set up Apple Pay sandbox testing for the Solidi Mobile App.

## Prerequisites
1. iOS Simulator or physical iOS device
2. Apple Developer Account
3. Xcode project configured with proper entitlements

## Step-by-Step Setup

### 1. Apple Developer Console Setup

#### Create Merchant Identifier:
1. Go to https://developer.apple.com/account/resources/identifiers/list
2. Click "+" to create a new identifier
3. Select "Merchant IDs"
4. Enter identifier: `merchant.com.henryyeung.mysolidimobileapp`
5. Enter description: "Solidi Mobile App Apple Pay"
6. Click "Continue" and "Register"

#### Create Merchant Identity Certificate:
1. In the Merchant ID details, click "Create Certificate"
2. Follow the CSR creation process
3. Download and install the certificate

### 2. Xcode Project Configuration

#### Add Apple Pay Capability:
1. Open `ios/SolidiMobileApp4.xcworkspace` in Xcode
2. Select the SolidiMobileApp4 target
3. Go to "Signing & Capabilities" tab
4. Click "+" and add "Apple Pay"
5. Select your merchant identifier: `merchant.com.henryyeung.mysolidimobileapp`

#### Update Code Signing:
1. Ensure your Apple Developer Team is selected
2. Enable "Automatically manage signing"
3. The entitlements file should be automatically linked

### 3. iOS Simulator Testing

#### For iOS Simulator:
1. Open Simulator
2. Go to Device > Wallet & Apple Pay
3. Add test credit cards provided by Apple:
   - Visa: 4111 1111 1111 1111
   - MasterCard: 5555 5555 5555 4444
   - American Express: 3782 822463 10005

#### For Physical Device:
1. Go to Settings > Wallet & Apple Pay
2. Add test cards using Apple's test card numbers
3. Ensure your device has a passcode or Touch/Face ID enabled

### 4. Testing the Implementation

1. Launch the app on iOS Simulator or device
2. Navigate to Wallet section
3. Try to make a deposit with a fiat currency (GBP, USD, EUR)
4. Select "Apple Pay" option
5. The Apple Pay sheet should appear with your test cards

### 5. Sandbox Environment Notes

- **Test Cards**: Use Apple's provided test card numbers
- **Transactions**: All transactions are simulated in sandbox
- **Real Money**: No real money is charged in sandbox mode
- **Testing**: Test various scenarios (success, failure, cancellation)

### 6. Production Deployment

When ready for production:
1. Create production merchant certificate
2. Update merchant identifier if needed
3. Configure your payment processor (Stripe, Braintree, etc.)
4. Update backend to handle real payment tokens
5. Test with production Apple Pay setup

### 7. Troubleshooting

#### Common Issues:
- **"Apple Pay Not Available"**: Check device capabilities and setup
- **"Merchant ID not configured"**: Verify Xcode capabilities setup
- **"Payment sheet not showing"**: Check merchant ID in code matches Xcode
- **"Invalid merchant"**: Ensure merchant ID is properly registered

#### Debug Steps:
1. Check iOS Simulator Wallet settings
2. Verify entitlements are correct
3. Check console logs for Apple Pay errors
4. Ensure bundle ID matches registered merchant ID

## Code Integration

The Apple Pay functionality is implemented in:
- `src/application/SolidiMobileApp/components/MainPanel/components/Wallet/Wallet.js`

Key functions:
- `handleApplePayDeposit()`: Initiates Apple Pay flow
- `processApplePayPayment()`: Processes payment response
- `canMakePayments()`: Checks Apple Pay availability

## Security Notes

- Payment tokens are securely generated by Apple
- No card details are stored in the app
- All sensitive data is handled by Apple Pay framework
- Backend integration required for production use